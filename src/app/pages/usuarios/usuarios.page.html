<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Gestión de Usuarios</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="abrirFormulario()">
        <ion-icon name="person-add-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-grid>
    <ion-row class="ion-align-items-center ion-justify-content-between">
      <!-- Botón Agregar a la izquierda -->
      <ion-col size="12" size-md="4">
        <ion-button (click)="abrirFormulario()" color="primary">
          <img src="assets/imagenes/agregar.png" class="icono-img" />
          Agregar Usuario
        </ion-button>
      </ion-col>

      <!-- Barra de búsqueda a la derecha -->
      <ion-col size="12" size-md="8">
        <ion-searchbar
          placeholder="Buscar usuarios..."
          [(ngModel)]="busqueda"
          (ionInput)="filtrarUsuarios()"
          class="buscador">
        </ion-searchbar>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-list>
    <ion-item *ngFor="let usuario of usuariosFiltrados">
      <ion-label>
        <h2>{{ usuario.name }} {{ usuario.lastname }}</h2>
        <p>{{ usuario.email }} ({{ usuario.username }})</p>
        <p>
          <span *ngFor="let rol of usuario.roles" class="rol-badge">{{ rol.name }}</span>
        </p>
      </ion-label>
      <ion-buttons slot="end">
        <ion-icon *ngIf="usuario.terminosAceptados === true" name="checkmark-circle" color="success" title="Términos y condiciones aceptados" style="font-size: 1.6em; vertical-align: middle; margin-right: 8px;"></ion-icon>
        <ion-icon *ngIf="usuario.terminosAceptados === false || usuario.terminosAceptados === undefined || usuario.terminosAceptados === null" name="alert-circle" color="danger" title="No ha aceptado los términos y condiciones" style="font-size: 1.6em; vertical-align: middle; margin-right: 8px;"></ion-icon>
       
        <ng-container *ngIf="usuario.terminosAceptados === true">
          <img src="assets/imagenes/acept.png" alt="Términos aceptados" title="Términos y condiciones aceptados" style="width: 30px; height: 30px; margin-right: 8px; vertical-align: middle;" />
        </ng-container>
        <ng-container *ngIf="usuario.terminosAceptados === false || usuario.terminosAceptados === undefined || usuario.terminosAceptados === null">
          <img src="assets/imagenes/alert.png" alt="No ha aceptado los términos" title="No ha aceptado los términos y condiciones" style="width: 30px; height: 30px; margin-right: 8px; vertical-align: middle;" />
        </ng-container>

        <ion-toggle
          [checked]="usuario.enabled"
          (ionChange)="onToggleEnabled(usuario)"
          color="success"
          [attr.aria-label]="'Habilitar o deshabilitar usuario ' + usuario.name"
          [attr.title]="usuario.enabled ? 'Usuario habilitado. Haz clic para deshabilitar.' : 'Usuario deshabilitado. Haz clic para habilitar.'"
          style="margin-right: 8px;">
        </ion-toggle>
        <ion-button fill="clear" (click)="editarUsuario(usuario)" title="Editar usuario">
          <img src="assets/imagenes/editar.png" class="icono-img" />
        </ion-button>
        <ion-button fill="clear" (click)="eliminarUsuario(usuario.id!)" title="Eliminar usuario">
          <img src="assets/imagenes/delete.png" class="icono-img" />
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>
</ion-content>